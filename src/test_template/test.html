<script>
/*
--GTM A/B test Variations code template--

Developers Note: replace all "nantu_x" ocurrences. Use a unique id that matches the clickup card ID for every test to avoid name collisions
*/

var nantu_x_test_version = 1; //Increase this number every time the test is being changed after receiving feedback from QA
var nantu_x_debug = false; // Set to false to turn off debug log messages

var nantu_x_selected_variation = "{{nantu_variation}}";
var nantu_x_variation_name = "{{nantu_variation_name}}";
var nantu_x_test_id = "{{nantu_test_id}}";
var nantu_x_experiment = "{{nantu_experiment}}";
var nantu_x_trigger_event = "{{Event}}";

var nantu_x_variation_name = "";

if("qa" === "{{nantu_mode_cookie}}" || "qa" === "{{nantu_mode_query_var}}" || localStorage.getItem("nantu_log_enable") == "yes") {
	nantu_x_debug = true;
}

// log message in the browser log
function nantu_x_log(nantu_x_message) {
	if (nantu_x_debug || localStorage.nantu_x_debug == "yes") {
		console.log("nantu_x:" + nantu_x_message);
	}
}
// Send data to data layer
function nantu_x_push_to_data_layer() {
	if(document.querySelectorAll("#nantu_x_tab_line > .inflow_qa_dimension").length > 0) {
		document.querySelector("#nantu_x_tab_line > .inflow_qa_dimension").innerText = " | " + nantu_x_test_data.ga_dimension;
	}

	var nantu_x_data_string = JSON.stringify(nantu_x_data);

	if (nantu_x_data_string != window.nantu_x_data_sent) {
		//only push data if it is the first time or data has been changed
		window.nantu_x_data_sent = nantu_x_data_string;

		if(localStorage.getItem("nantu_x_test_set") != nantu_x_variation_name) {
			dataLayer.push(nantu_x_data);
		}
	}

	var nantu_ga4_data = {
		"nantu_version" : "1.6",
		"nantu_ab_test_experiment_name" : nantu_x_test_data.experiment_name,
		"nantu_ab_test_variation" : window.nantu_x_variation_name,
		"nantu_ab_test_index" : nantu_x_test_data.test_index
	};

	nantu_x_log("setting GA4 user property: nantu_ab_test" + nantu_x_test_data.test_index);

	var nantu_ga4_data_string = JSON.stringify(nantu_ga4_data);

	if (nantu_ga4_data_string != window.nantu_ga4_data_sent) {
		//only push data if it is the first time or data has been changed
		window.nantu_ga4_data_sent = nantu_ga4_data_string;

		nantu_ga4_event_id = "nantu_ab_test" + nantu_x_test_data.test_index;

		if(localStorage.getItem(nantu_ga4_event_id) != nantu_x_variation_name) {
			nantu_ga4_data["event"] = "nantu_ab_test" + nantu_x_test_data.test_index;

			nantu_ga4_data["eventTimeout"] = 2000;

			nantu_ga4_data["eventCallback"] = function() {
        			localStorage.setItem(nantu_ga4_event_id, nantu_x_variation_name);
      			}

			dataLayer.push(nantu_ga4_data);
		}
	}
}

if(nantu_x_trigger_event.indexOf("nantu_x_execute") > -1) {
	if(document.querySelectorAll("#nantu_x_tab_line > .inflow_qa_id").length > 0)
	{
		document.querySelector("#nantu_x_tab_line > .inflow_qa_id").innerText = nantu_x_test_data.test_index + ":" + nantu_x_test_version + " ";
	}

	//The code of the A/B test variations goes here
	nantu_x_push_to_data_layer();

	// End of A/B test variations code
} else {
	nantu_x_log("setup error, this tag should be triggered by an event that starts with nantu_x_execute");
}
</script>
<style>
</style>
